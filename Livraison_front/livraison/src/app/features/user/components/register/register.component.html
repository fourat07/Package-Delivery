<div class="modal fade show d-block" tabindex="-1" role="dialog" *ngIf="showModal" style="background: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">Register New User</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <form (ngSubmit)="onSubmit(registerForm)" #registerForm="ngForm">

          <!-- Username -->
          <div class="form-group mb-3">
            <label for="username">Username</label>
            <input
              type="text"
              class="form-control"
              id="username"
              name="username"
              [(ngModel)]="user.username"
              #username="ngModel"
              required
              minlength="4"
              placeholder="Choose a username" />
            <div class="text-danger small" *ngIf="username.invalid && (username.dirty || username.touched)">
              <span *ngIf="username.errors?.['required']">Username is required.</span>
              <span *ngIf="username.errors?.['minlength']">Minimum 4 characters.</span>
            </div>
          </div>

          <!-- Email -->
          <div class="form-group mb-3">
            <label for="email">Email</label>
            <input
              type="email"
              class="form-control"
              id="email"
              name="email"
              [(ngModel)]="user.email"
              #email="ngModel"
              required
              pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
              placeholder="your@email.com" />
            <div class="text-danger small" *ngIf="email.invalid && (email.dirty || email.touched)">
              <span *ngIf="email.errors?.['required']">Email is required.</span>
              <span *ngIf="email.errors?.['pattern']">Invalid email format.</span>
            </div>
          </div>

          <!-- Password -->
          <div class="form-group mb-3">
            <label for="password">Password</label>
            <input
              [type]="passwordVisible ? 'text' : 'password'"
              class="form-control"
              id="password"
              name="password"
              [(ngModel)]="user.password"
              #password="ngModel"
              required
              minlength="6"
              placeholder="Create a password" />
            <div class="text-danger small" *ngIf="password.invalid && (password.dirty || password.touched)">
              <span *ngIf="password.errors?.['required']">Password is required.</span>
              <span *ngIf="password.errors?.['minlength']">Minimum 6 characters.</span>
            </div>
          </div>

          <!-- Toggle password visibility -->
          <div class="form-check mb-3">
            <input type="checkbox" class="form-check-input" id="showPassword" (change)="passwordVisible = !passwordVisible">
            <label class="form-check-label" for="showPassword">Show Password</label>
          </div>

          <!-- Phone Number -->
          <div class="form-group mb-3">
            <label for="phoneNumber">Phone Number</label>
            <input
              type="tel"
              class="form-control"
              id="phoneNumber"
              name="phoneNumber"
              [(ngModel)]="user.phoneNumber"
              #phone="ngModel"
              required
              pattern="[0-9]{8}"
              placeholder="8-digit number" />
            <div class="text-danger small" *ngIf="phone.invalid && (phone.dirty || phone.touched)">
              <span *ngIf="phone.errors?.['required']">Phone number is required.</span>
              <span *ngIf="phone.errors?.['pattern']">Must be exactly 8 digits.</span>
            </div>
          </div>

          <!-- Adresse -->
          <div class="form-group mb-3">
            <label for="adresse">Adresse</label>
            <input
              type="text"
              class="form-control"
              id="adresse"
              name="adresse"
              [(ngModel)]="user.adresse"
              #adresse="ngModel"
              required
              placeholder="Enter address" />
            <div class="text-danger small" *ngIf="adresse.invalid && (adresse.dirty || adresse.touched)">
              <span *ngIf="adresse.errors?.['required']">Address is required.</span>
            </div>
          </div>

          <!-- Role -->
          <div class="form-group mb-3">
            <label for="role">Role</label>
            <select
              class="form-control"
              id="role"
              name="role"
              [(ngModel)]="user.role"
              #role="ngModel"
              required>
              <option value="" disabled>Select a role</option>
              <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
            </select>
            <div class="text-danger small" *ngIf="role.invalid && (role.dirty || role.touched)">
              <span *ngIf="role.errors?.['required']">Role is required.</span>
            </div>
          </div>

          <!-- Frais Retour (conditional) -->
          <div class="form-group mb-3" *ngIf="user.role === 'ROLE_EXPEDITEUR'">
            <label for="frais_retour">Frais Retour</label>
            <input
              type="number"
              step="0.01"
              class="form-control"
              id="frais_retour"
              name="frais_retour"
              [(ngModel)]="user.frais_retour"
              placeholder="Enter return fees" />
          </div>

          <!-- Error message (optional) -->
          <div *ngIf="registerError" class="text-danger text-center mt-2">
            {{ registerError }}
          </div>

          <!-- Submit Button -->
          <div class="modal-footer">
            <button type="submit" class="btn btn-success" [disabled]="registerForm.invalid || isLoading">
              <span *ngIf="!isLoading">Register</span>
              <span *ngIf="isLoading" class="spinner-border spinner-border-sm"></span>
            </button>
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          </div>

        </form>
      </div>

    </div>
  </div>
</div>
